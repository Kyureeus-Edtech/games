<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>One Password, Many Doors</title>
  <style>
    :root{
      --bg:#000033;          /* deep navy */
      --fg:#39FF14;          /* neon green */
      --warn:#FF3131;        /* warning red */
      --gold:#FFD700;        /* locked gold */
      --muted:#0b1a66;       /* card bg tint */
      --panel:#01014a;       /* panel bg */
      --hacker-speed: 18s;   /* updated on wrong answers */
    }

    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: 'Roboto Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background: var(--bg);
      color: var(--fg);
      line-height:1.5;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    a{color:var(--fg)}
    button{
      font: inherit; color: var(--bg); background: var(--fg);
      border: 2px solid var(--fg); padding: .7rem 1.1rem; border-radius: 6px; cursor:pointer;
      transition: transform .06s ease, box-shadow .2s ease; box-shadow: 0 0 0px 0 var(--fg);
    }
    button:hover{ transform: translateY(-1px); box-shadow: 0 0 16px 2px rgba(57,255,20,.3)}
    button.ghost{ background: transparent; color: var(--fg); }
    button.warn{ background: var(--warn); border-color: var(--warn); color: white; }
    button.gold{ background: var(--gold); border-color: var(--gold); color: #121212; }

    .screen{ display:none; min-height:100dvh; padding: clamp(16px, 2vw, 32px);} .screen.active{ display:block }
    .wrap{ max-width:1100px; margin:0 auto }
    .term{ border:2px solid rgba(57,255,20,.35); background: linear-gradient(180deg, rgba(1,1,64,.35), rgba(1,1,64,.15)); box-shadow: 0 0 24px rgba(57,255,20,.12) inset, 0 0 40px rgba(0,0,0,.4); border-radius: 12px; padding: clamp(16px, 2vw, 28px); position:relative; overflow:hidden; }
    .term::after{ content:""; position:absolute; inset:0; pointer-events:none; background: repeating-linear-gradient(to bottom, rgba(0,0,0,0) 0px, rgba(0,0,0,0) 2px, rgba(0,0,0,.14) 3px); mix-blend-mode: overlay; }

    h1,h2,h3{ font-weight:700; letter-spacing:.02em; margin:0 0 .5rem } h1{ font-size: clamp(28px, 4vw, 46px) }
    .subtitle{ opacity:.85; margin-bottom:1rem }

    .intro-grid{ display:grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 900px){ .intro-grid{ grid-template-columns: 1.3fr .9fr } }
    .video-box{ aspect-ratio: 16/9; border:2px dashed rgba(57,255,20,.3); border-radius:10px; display:grid; place-items:center; background: rgba(1,1,80,.35); overflow:hidden}
    .video-box iframe{ width:100%; height:100%; border:0 }

    .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center }

    .hud{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; margin-bottom:12px }
    .hud .badge{ border:1px solid rgba(57,255,20,.4); padding:.5rem .75rem; border-radius:8px; background: rgba(1,1,70,.5); display:inline-flex; gap:.5rem; align-items:center }
    .timer.warn{ color: var(--warn) }

    .doors{ display:grid; gap:12px; margin-top:10px; grid-template-columns: repeat(2, minmax(0,1fr)); }
    @media (min-width: 700px){ .doors{ grid-template-columns: repeat(5, minmax(0,1fr)) } }
    .door{ --accent: var(--fg); background: linear-gradient(180deg, rgba(7,16,106,.5), rgba(2,2,54,.9)); border:2px solid var(--accent); border-radius: 12px; position:relative; overflow:hidden; min-height: 120px; cursor:pointer; transition: transform .08s ease, box-shadow .25s ease, border-color .2s ease, background .2s ease; box-shadow: 0 0 0 rgba(57,255,20,0.2); }
    .door:hover{ transform: translateY(-2px); box-shadow: 0 0 22px rgba(57,255,20,.25) }
    .door.locked{ --accent: var(--gold); background: linear-gradient(180deg, rgba(87,74,0,.35), rgba(30,24,0,.55)); }
    .door.fail{ --accent: var(--warn); }
    .door-content{ padding:14px; display:grid; place-items:center; text-align:center; height:100% }
    .door h3{ font-size: clamp(14px, 2.4vw, 18px); margin:6px 0 0 }
    .lock{ width: 44px; height: 44px; display:inline-block; background: currentColor; mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23000"><path d="M12 1a5 5 0 0 0-5 5v3H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-9a2 2 0 0 0-2-2h-1V6a5 5 0 0 0-5-5Zm3 8H9V6a3 3 0 0 1 6 0v3Z"/></svg>') center/contain no-repeat; color: var(--accent); filter: drop-shadow(0 0 8px rgba(255,215,0,.25)); }

    .center-msg{ margin:14px 0 6px; padding:10px 12px; border:1px dashed rgba(57,255,20,.4); border-radius:8px; background: rgba(1,1,70,.35); font-size: clamp(12px, 2.4vw, 14px); }

    .hacker-lane{ position:relative; height:72px; margin-top:16px; border-top:1px dashed rgba(57,255,20,.25) }
    .hacker{ position:absolute; bottom:6px; left:0; width:64px; height:64px; background: currentColor; color: rgba(57,255,20,.85); mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><path d="M32 6a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm-6 22h12l12 10v16H14V38l12-10Z"/></svg>') center/contain no-repeat; animation: glide var(--hacker-speed) linear infinite alternate; filter: drop-shadow(0 0 12px rgba(57,255,20,.35)); }
    @keyframes glide { from{ left:0 } to{ left: calc(100% - 64px) } }

    .modal{ position: fixed; inset:0; display:none; place-items:center; padding:16px; z-index:40 }
    .modal.show{ display:grid; }
    .modal .overlay{ position:absolute; inset:0; background: rgba(0,0,0,.7); backdrop-filter: blur(2px) }
    .modal .panel{ position:relative; z-index:1; width:min(900px, 96vw); max-height:88vh; overflow:auto; background: var(--panel); border:2px solid rgba(57,255,20,.4); border-radius:12px; padding:16px; box-shadow: 0 0 30px rgba(57,255,20,.25); }

    .choices{ display:grid; gap:10px; margin:12px 0 } .choices button{ text-align:left }
    .kicker{ font-size:.9rem; opacity:.9; letter-spacing:.06em }
    .big{ font-size: clamp(22px, 4.5vw, 36px); font-weight:800; letter-spacing:.04em }
    .muted{ opacity:.85 }

    .mt-1{ margin-top:.5rem } .mt-2{ margin-top:1rem } .mt-3{ margin-top:1.5rem } .mb-2{ margin-bottom:1rem }
    .grid{ display:grid; gap:12px } .two{ grid-template-columns: 1fr } @media(min-width: 800px){ .two{ grid-template-columns: 1fr 1fr } }
    textarea.report{ width:100%; min-height: 40vh; background:#01013a; color: var(--fg); border:1px solid rgba(57,255,20,.35); border-radius:8px; padding:10px; font:inherit; resize:vertical }

    .cursor{ display:inline-block; width:.6ch; background: var(--fg); animation: blink 1.2s steps(2,end) infinite }
    @keyframes blink{ 50%{ background:transparent } }
    .pulse{ animation: pulse 1.2s infinite }
    @keyframes pulse{ 0%,100%{ box-shadow: 0 0 0px rgba(255,49,49,0)} 50%{ box-shadow: 0 0 18px rgba(255,49,49,.35) } }
    .tiny{ font-size:.8rem; opacity:.75 }

    /* Montage images */
    .montage-img{ max-width:100%; border:2px solid rgba(57,255,20,.35); border-radius:8px; margin:12px 0; }
  </style>
</head>
<body>
  <!-- INTRO SCREEN -->
  <section id="intro" class="screen active">
    <div class="wrap term">
      <h1>ONE PASSWORD, MANY DOORS <span class="cursor"></span></h1>
      <p class="subtitle">Vendors need access. Attackers want access. Your job: lock down the right doors before time runs out.</p>

      <div class="intro-grid mt-2">
        <div class="video-box">
          <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Intro Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>
        <div class="grid">
          <div class="center-msg">In this training, each <strong>door</strong> represents a core security principle. Answer correctly to <strong>lock</strong> it. Two mistakes or a timer breach and it's <span style="color:var(--warn)">GAME OVER</span>.</div>
          <div class="row">
            <button id="startBtn" class="gold" aria-label="Start the game">START</button>
            <button class="ghost" id="howBtn">How to Play</button>
          </div>
          <div class="tiny">Theme: Retro hacker terminal • Colors: Neon green, warning red, lock gold • Fully responsive</div>
        </div>
      </div>
    </div>
  </section>

  <!-- GAME SCREEN -->
  <section id="game" class="screen">
    <div class="wrap term">
      <div class="hud">
        <div class="badge">SCORE: <strong id="score">0</strong></div>
        <div class="badge">LOCKED: <strong id="lockedCount">0</strong>/5</div>
        <div class="badge">FAILS: <strong id="fails">0</strong>/2</div>
        <div class="badge timer" id="timer">03:00</div>
      </div>

      <div id="instruction" class="center-msg">Tap a door to answer and lock it. Wrong answers make the hacker move faster…</div>

      <div class="doors" id="doors"></div>

      <div class="hacker-lane">
        <div class="hacker" id="hacker"></div>
      </div>
    </div>
  </section>

  <!-- BREACH SCREEN -->
  <section id="breach" class="screen">
    <div class="wrap term">
      <div class="big" style="color:var(--warn)">SYSTEMS BREACHED</div>
      <p class="mt-1">A single weak control can open many doors. In 2013, Target suffered a major breach originating from a third‑party vendor. Lateral movement and insufficient network segmentation amplified impact.</p>
      <div class="row mt-2">
        <button class="warn" id="retryBtn">RETRY</button>
        <button class="ghost" id="breachReportBtn">Export Report</button>
      </div>
      <p class="tiny mt-2">Tip: Slow down attackers by enabling <strong>MFA</strong>, using <strong>least privilege</strong>, granting <strong>just‑in‑time</strong> access, adopting <strong>zero trust</strong>, and <strong>segmenting networks</strong>.</p>
    </div>
  </section>

  <!-- RESULT SCREEN -->
  <section id="result" class="screen">
    <div class="wrap term">
      <div class="grid two">
        <div>
          <div class="big" style="color:var(--gold)">ALL DOORS LOCKED</div>
          <p class="mt-1">Nice work! Final Score: <strong id="finalScore">0</strong></p>
          <div class="center-msg mt-1">
            <strong>Next Moves (on the job):</strong>
            <ul>
              <li>Enforce MFA for all third‑party access.</li>
              <li>Grant least privilege by default; elevate via JIT.</li>
              <li>Adopt zero‑trust checks on every request.</li>
              <li>Segment vendor traffic to only necessary assets.</li>
              <li>Continuously monitor & revoke stale access.</li>
            </ul>
          </div>
          <div class="row mt-2">
            <button id="replayBtn">REPLAY</button>
            <button id="exportBtn" class="ghost">EXPORT REPORT</button>
          </div>
        </div>
        <div class="video-box">
          <iframe src="https://www.youtube.com/embed/9bZkp7q19f0" title="Outro Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </section>

  <!-- MONTAGE SCREEN (shows after win) -->
  <section id="montage" class="screen">
    <div class="wrap term">
      <div class="big" style="color:var(--gold)">Correct Choices vs. 2013 Target Breach</div>
      <p class="mt-1">A quick visual comparison of how secure decisions block attacks, contrasted with the 2013 Target breach.</p>
      <div class="grid">
        <img src="montage1.png" alt="Correct security choices glowing icons" class="montage-img">
        <img src="montage2.png" alt="Target 2013 breach scene" class="montage-img">
        <img src="montage3.png" alt="All doors locked, hacker blocked" class="montage-img">
      </div>
      <p class="center-msg mt-2">Correct Choices Stop Breaches. Learn from the 2013 Target Breach.</p>
      <div class="row mt-2">
        <button id="montageContinueBtn" class="gold">Continue to Results</button>
        <button id="montageReplayBtn">Replay Game</button>
        <button id="montageExportBtn" class="ghost">Export Report</button>
      </div>
    </div>
  </section>

  <!-- QUESTION MODAL -->
  <div class="modal" id="qModal" aria-modal="true" role="dialog">
    <div class="overlay" data-close></div>
    <div class="panel">
      <div class="kicker" id="qKicker">Door: —</div>
      <h2 id="qTitle">Question</h2>
      <p id="qText">…</p>
      <div class="choices" id="qChoices"></div>
      <div class="row mt-2">
        <button class="ghost" data-close>Cancel</button>
      </div>
    </div>
  </div>

  <!-- FEEDBACK MODAL -->
  <div class="modal" id="fbModal" aria-modal="true" role="dialog">
    <div class="overlay"></div>
    <div class="panel">
      <div class="kicker" id="fbHeader">Feedback</div>
      <p id="fbText">…</p>
      <div class="row mt-2">
        <button id="fbContinue">Continue</button>
      </div>
    </div>
  </div>

  <!-- REPORT MODAL -->
  <div class="modal" id="reportModal" aria-modal="true" role="dialog">
    <div class="overlay" data-close></div>
    <div class="panel">
      <h2>Game Session Report</h2>
      <textarea class="report" id="reportText" readonly></textarea>
      <div class="row mt-2">
        <button id="copyBtn" class="gold">Copy to Clipboard</button>
        <button class="ghost" data-close>Close</button>
      </div>
      <p class="tiny mt-1">Copies using <code>document.execCommand('copy')</code> for maximum compatibility.</p>
    </div>
  </div>

  <!-- HOW-TO MODAL -->
  <div class="modal" id="howModal" aria-modal="true" role="dialog">
    <div class="overlay" data-close></div>
    <div class="panel">
      <h2>How to Play</h2>
      <ol>
        <li>Click a door to answer a question about that security principle.</li>
        <li>Correct answers lock the door (<span style="color:var(--gold)">gold</span>) and grant +100 points.</li>
        <li>Wrong answers speed up the hacker (<span style="color:var(--warn)">red threat</span> rises). Two total failures trigger a breach.</li>
        <li>Lock all five doors before the timer hits 0.</li>
        <li>Export your training report at the end.</li>
      </ol>
      <div class="row mt-2"><button class="ghost" data-close>Got it</button></div>
    </div>
  </div>

<script>
(function(){
  // ------------- Config -------------
  const AUTO_ADVANCE_SECONDS = 0; // set >0 to auto-advance from montage to results

  // ------------- Data -------------
  const DOORS = [
    { id:"least-privilege", label:"Least Privilege", question:"A new vendor support account needs database access. What's the best initial permission?", choices:[
      { text:"Grant read/write to all schemas so they can work fast.", correct:false, explain:"Over‑privileging increases blast radius. Start with only what's required."},
      { text:"Grant read access only to the specific tables they support.", correct:true, explain:"Least privilege means granting the minimal access necessary to perform duties."},
      { text:"Grant admin temporarily and monitor.", correct:false, explain:"Admin – even temporarily – is risky unless strictly time‑bound and justified."}
    ] },
    { id:"jit", label:"Just‑in‑Time Access", question:"An engineer needs elevated rights for a 30‑minute task. What's the safest approach?", choices:[
      { text:"Permanent role change to PowerUser to avoid delays next time.", correct:false, explain:"Standing privileges accumulate risk. Prefer ephemeral elevation."},
      { text:"Issue time‑boxed elevation with approval workflow.", correct:true, explain:"JIT grants just enough privilege, for just long enough, with auditability."},
      { text:"Share a break‑glass admin password over chat.", correct:false, explain:"Shared credentials remove accountability and often persist beyond need."}
    ] },
    { id:"mfa", label:"MFA", question:"A vendor logs in from a new device. Which control most reduces account takeover risk?", choices:[
      { text:"IP allowlist only.", correct:false, explain:"Allowlists help, but credentials can still be phished. Add strong MFA."},
      { text:"Require MFA with phishing‑resistant methods (FIDO/WebAuthn) where possible.", correct:true, explain:"MFA – especially phishing‑resistant – drastically reduces ATO success."},
      { text:"Longer password only.", correct:false, explain:"Password complexity alone is insufficient against modern phishing kits."}
    ] },
    { id:"zero-trust", label:"Zero Trust", question:"A vendor app connects to an internal API. What's a zero‑trust aligned step?", choices:[
      { text:"Trust all traffic once inside the VPN.", correct:false, explain:"Zero trust assumes breach; every request must be verified and authorized."},
      { text:"Continuously verify identity, device posture, and context on each request.", correct:true, explain:"ZT = never trust, always verify + least privilege + micro‑segmentation."},
      { text:"Disable logging to reduce latency.", correct:false, explain:"Visibility is core to zero trust; you need telemetry for decisions."}
    ] },
    { id:"segmentation", label:"Network Segmentation", question:"Vendors need to access one app in your data center. Best network design?", choices:[
      { text:"Place vendor VPN in the same flat network as production servers.", correct:false, explain:"Flat networks allow lateral movement; segment to limit reach."},
      { text:"Isolate vendor access to a dedicated segment with only necessary routes.", correct:true, explain:"Segmentation constrains movement if any vendor account is compromised."},
      { text:"Allow any‑any rules and rely on endpoint AV only.", correct:false, explain:"Prevention and containment need layered controls, not any‑any."}
    ] }
  ];

  // ------------- State -------------
  let score = 0; let fails = 0; let locked = new Set(); let timerId = null; let remaining = 180; let gameOver = false; let hackerSpeed = 18;
  const gameLog = [];

  // ------------- Helpers -------------
  const $ = s => document.querySelector(s); // vanilla helpers (no jQuery)
  const $$ = s => Array.from(document.querySelectorAll(s));
  const screens = { intro: $('#intro'), game: $('#game'), breach: $('#breach'), result: $('#result'), montage: $('#montage') };
  function showScreen(name){ Object.values(screens).forEach(el => el.classList.remove('active')); screens[name].classList.add('active'); }
  function fmtTime(sec){ const m = Math.floor(sec/60).toString().padStart(2,'0'); const s = (sec%60).toString().padStart(2,'0'); return `${m}:${s}`; }
  function updateHUD(){ $('#score').textContent = score; $('#fails').textContent = fails; $('#lockedCount').textContent = locked.size; const t = $('#timer'); t.textContent = fmtTime(remaining); t.classList.toggle('warn', remaining <= 30); }
  function stopTimer(){ if (timerId){ clearInterval(timerId); timerId = null; } }
  function startTimer(){ stopTimer(); timerId = setInterval(()=>{ if (gameOver) return; remaining--; updateHUD(); if (remaining <= 0 && locked.size < DOORS.length){ endBreach('Timer expired before all doors were locked.'); } }, 1000); }
  function setHackerSpeed(seconds){ hackerSpeed = Math.max(4, seconds); document.documentElement.style.setProperty('--hacker-speed', hackerSpeed + 's'); }

  function resetGame(){ score = 0; fails = 0; locked = new Set(); remaining = 180; gameOver = false; setHackerSpeed(18); $('#instruction').textContent = 'Tap a door to answer and lock it. Wrong answers make the hacker move faster…'; updateHUD();
    const d = $('#doors'); d.innerHTML = ''; DOORS.forEach(def =>{ const card = document.createElement('button'); card.className = 'door'; card.dataset.id = def.id; card.innerHTML = `<div class="door-content"><span class="lock"></span><h3>${def.label}</h3></div>`; card.addEventListener('click', ()=> openQuestion(def)); d.appendChild(card); }); }

  function openQuestion(def){ if (gameOver) return; if (locked.has(def.id)) return; $('#qKicker').textContent = `Door: ${def.label}`; $('#qTitle').textContent = 'Secure the Door'; $('#qText').textContent = def.question; const container = $('#qChoices'); container.innerHTML=''; def.choices.forEach((c, idx)=>{ const btn=document.createElement('button'); btn.innerHTML = `(${String.fromCharCode(65+idx)}) ${c.text}`; btn.addEventListener('click', ()=> answer(def,c)); container.appendChild(btn); }); openModal('#qModal'); }

  function answer(def, choice){ closeModal('#qModal'); const correct = !!choice.correct; const logEntry = { timestamp:new Date().toISOString(), door:def.label, question:def.question, choice:choice.text, correct, explanation:choice.explain }; gameLog.push(logEntry);
    const doorEl = document.querySelector(`.door[data-id="${def.id}"]`);
    if (correct){ score += 100; locked.add(def.id); doorEl.classList.remove('fail'); doorEl.classList.add('locked'); $('#instruction').textContent = `${def.label} locked. ${5-locked.size} to go!`; }
    else{ fails += 1; doorEl.classList.add('fail'); setHackerSpeed(hackerSpeed - 4); $('#instruction').textContent = `Incorrect. Hacker speeds up! (${fails}/2 failures)`; }
    updateHUD();
    $('#fbHeader').textContent = correct ? 'Access Decision: Correct' : 'Access Decision: Incorrect'; $('#fbText').innerHTML = `<strong>${correct ? 'Why this works:' : 'Risk:'}</strong> ${choice.explain}`; openModal('#fbModal');
    const proceed = ()=>{ $('#fbContinue').removeEventListener('click', proceed); closeModal('#fbModal'); if (fails>=2){ endBreach('Too many incorrect decisions (2).'); return; } if (locked.size === DOORS.length){ endWin(); return; } };
    $('#fbContinue').addEventListener('click', proceed);
  }

  function endBreach(reason){ if (gameOver) return; gameOver = true; stopTimer(); gameLog.push({ timestamp:new Date().toISOString(), door:'—', question:'—', choice:'—', correct:false, explanation:`Breach: ${reason}` }); showScreen('breach'); $('#timer').classList.add('pulse'); }

  function endWin(){ if (gameOver) return; gameOver = true; stopTimer(); $('#finalScore').textContent = score; gameLog.push({ timestamp:new Date().toISOString(), door:'—', question:'—', choice:'—', correct:true, explanation:`Win: All doors locked with score ${score}` }); showScreen('montage'); if (AUTO_ADVANCE_SECONDS>0){ setTimeout(()=> showScreen('result'), AUTO_ADVANCE_SECONDS*1000); } }

  function exportReport(){ const lines = []; lines.push('=== One Password, Many Doors — Training Report ==='); lines.push(`Generated: ${new Date().toString()}`); lines.push(`Final Score: ${score}`); lines.push(''); lines.push('Decisions:'); gameLog.forEach((e,i)=>{ lines.push(`${i+1}. ${e.timestamp}`); lines.push(`   Door: ${e.door}`); lines.push(`   Question: ${e.question}`); lines.push(`   Choice: ${e.choice}`); lines.push(`   Correct: ${e.correct ? 'Yes' : 'No'}`); lines.push(`   Explanation: ${e.explanation}`); lines.push(''); }); const ta = $('#reportText'); ta.value = lines.join('\n'); openModal('#reportModal'); }
  function copyReport(){ const ta = $('#reportText'); ta.focus(); ta.select(); try{ const ok = document.execCommand('copy'); if (ok){ const old = $('#copyBtn').textContent; $('#copyBtn').textContent='Copied!'; setTimeout(()=> $('#copyBtn').textContent=old,1200); } }catch(e){}
  }

  // ---- Modal utils ----
  function openModal(sel){ document.querySelector(sel).classList.add('show'); }
  function closeModal(sel){ document.querySelector(sel).classList.remove('show'); }
  $$('#qModal [data-close], #reportModal [data-close], #howModal [data-close]').forEach(b=> b.addEventListener('click', ev=> closeModal('#'+ev.target.closest('.modal').id)));
  $$('#qModal .overlay, #reportModal .overlay, #howModal .overlay').forEach(ov=> ov.addEventListener('click', ev=> closeModal('#'+ev.target.closest('.modal').id)));

  // ---- Wire up buttons ----
  $('#startBtn').addEventListener('click', ()=>{ resetGame(); showScreen('game'); startTimer(); });
  $('#howBtn').addEventListener('click', ()=> openModal('#howModal'));
  $('#retryBtn').addEventListener('click', ()=>{ resetGame(); showScreen('game'); startTimer(); });
  $('#replayBtn').addEventListener('click', ()=>{ resetGame(); showScreen('game'); startTimer(); });
  $('#exportBtn').addEventListener('click', exportReport);
  $('#breachReportBtn').addEventListener('click', exportReport);
  $('#copyBtn').addEventListener('click', copyReport);
  $('#montageExportBtn')?.addEventListener('click', exportReport);
  $('#montageReplayBtn')?.addEventListener('click', ()=>{ resetGame(); showScreen('game'); startTimer(); });
  $('#montageContinueBtn')?.addEventListener('click', ()=> showScreen('result'));

  // ---- Smoke tests (console) ----
  function runSmokeTests(){
    console.group('%cSMOKE TESTS','color:#39FF14');
    console.assert(typeof $ === 'function', 'Helper $ should be defined');
    console.assert(DOORS.length === 5, 'There should be 5 doors');
    console.assert(typeof document.execCommand === 'function', 'execCommand should exist for copy');
    resetGame();
    console.assert($('#doors').children.length === 5, 'Five door elements should render');
    // Ensure timer does not breach after all locked
    locked = new Set(DOORS.map(d=>d.id)); remaining = 0; updateHUD();
    // Manually invoke breach check path: startTimer tick would breach only if locked.size < DOORS.length
    console.assert(locked.size === DOORS.length, 'All doors locked -> timer expiry should not breach');
    stopTimer();
    console.groupEnd();
  }
  runSmokeTests();

})();
</script>
</body>
</html>
